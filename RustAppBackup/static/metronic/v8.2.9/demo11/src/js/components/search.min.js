"use strict";var KTSearch=function(element,options){var the=this;if(!element){return}var defaultOptions={minLength:2,keypress:true,enter:true,layout:"menu",responsive:null,showOnFocus:true};var _construct=function(){if(KTUtil.data(element).has("search")===true){the=KTUtil.data(element).get("search")}else{_init()}};var _init=function(){the.options=KTUtil.deepExtend({},defaultOptions,options);the.processing=false;the.element=element;the.contentElement=_getElement("content");the.formElement=_getElement("form");the.inputElement=_getElement("input");the.spinnerElement=_getElement("spinner");the.clearElement=_getElement("clear");the.toggleElement=_getElement("toggle");the.submitElement=_getElement("submit");the.toolbarElement=_getElement("toolbar");the.minLength=parseInt(_getOption("min-length"));the.resultsElement=_getElement("results");the.suggestionElement=_getElement("suggestion");the.emptyElement=_getElement("empty");the.element.setAttribute("data-kt-search","true");the.layout=_getOption("layout");if(the.layout==="menu"){the.menuObject=new KTMenu(the.contentElement)}else{the.menuObject=null}_update();_handlers();KTUtil.data(the.element).set("search",the)};var _handlers=function(){the.inputElement.addEventListener("focus",_focus);the.inputElement.addEventListener("blur",_blur);if(_getOption("keypress")===true){the.inputElement.addEventListener("input",_input)}if(the.submitElement){the.submitElement.addEventListener("click",_search)}if(_getOption("enter")===true){the.inputElement.addEventListener("keypress",_enter)}if(the.clearElement){the.clearElement.addEventListener("click",_clear)}if(the.menuObject){if(the.toggleElement){the.toggleElement.addEventListener("click",_show);the.menuObject.on("kt.menu.dropdown.show",function(item){if(KTUtil.visible(the.toggleElement)){the.toggleElement.classList.add("active");the.toggleElement.classList.add("show")}});the.menuObject.on("kt.menu.dropdown.hide",function(item){if(KTUtil.visible(the.toggleElement)){the.toggleElement.classList.remove("active");the.toggleElement.classList.remove("show")}})}the.menuObject.on("kt.menu.dropdown.shown",function(){the.inputElement.focus()})}window.addEventListener("resize",function(){var timer;KTUtil.throttle(timer,function(){_update()},200)})};var _focus=function(){the.element.classList.add("focus");if(_getOption("show-on-focus")===true||the.inputElement.value.length>=the.minLength){_show()}};var _blur=function(){the.element.classList.remove("focus")};var _enter=function(e){var key=e.charCode||e.keyCode||0;if(key==13){e.preventDefault();_search()}};var _input=function(){if(_getOption("min-length")){if(the.inputElement.value.length>=the.minLength){_search()}else if(the.inputElement.value.length===0){_clear()}}};var _search=function(){if(the.processing===false){if(the.spinnerElement){the.spinnerElement.classList.remove("d-none")}if(the.clearElement){the.clearElement.classList.add("d-none")}if(the.toolbarElement&&the.formElement.contains(the.toolbarElement)){the.toolbarElement.classList.add("d-none")}the.inputElement.focus();the.processing=true;KTEventHandler.trigger(the.element,"kt.search.process",the)}};var _complete=function(){if(the.spinnerElement){the.spinnerElement.classList.add("d-none")}if(the.clearElement){the.clearElement.classList.remove("d-none")}if(the.inputElement.value.length===0){_clear()}the.inputElement.focus();_show();the.processing=false};var _clear=function(){if(KTEventHandler.trigger(the.element,"kt.search.clear",the)===false){return}the.inputElement.value="";the.inputElement.focus();if(the.clearElement){the.clearElement.classList.add("d-none")}if(the.toolbarElement&&the.formElement.contains(the.toolbarElement)){the.toolbarElement.classList.remove("d-none")}if(_getOption("show-on-focus")===false){_hide()}KTEventHandler.trigger(the.element,"kt.search.cleared",the)};var _update=function(){if(the.layout==="menu"){var responsiveFormMode=_getResponsiveFormMode();if(responsiveFormMode==="on"&&the.contentElement.contains(the.formElement)===false){the.contentElement.prepend(the.formElement);the.formElement.classList.remove("d-none")}else if(responsiveFormMode==="off"&&the.contentElement.contains(the.formElement)===true){the.element.prepend(the.formElement);the.formElement.classList.add("d-none")}}};var _show=function(){if(the.menuObject){_update();the.menuObject.show(the.element)}};var _hide=function(){if(the.menuObject){_update();the.menuObject.hide(the.element)}};var _getOption=function(name){if(the.element.hasAttribute("data-kt-search-"+name)===true){var attr=the.element.getAttribute("data-kt-search-"+name);var value=KTUtil.getResponsiveValue(attr);if(value!==null&&String(value)==="true"){value=true}else if(value!==null&&String(value)==="false"){value=false}return value}else{var optionName=KTUtil.snakeToCamel(name);if(the.options[optionName]){return KTUtil.getResponsiveValue(the.options[optionName])}else{return null}}};var _getElement=function(name){return the.element.querySelector('[data-kt-search-element="'+name+'"]')};var _getResponsiveFormMode=function(){var responsive=_getOption("responsive");var width=KTUtil.getViewPort().width;if(!responsive){return null}var breakpoint=KTUtil.getBreakpoint(responsive);if(!breakpoint){breakpoint=parseInt(responsive)}if(width<breakpoint){return"on"}else{return"off"}};var _destroy=function(){KTUtil.data(the.element).remove("search")};_construct();the.show=function(){return _show()};the.hide=function(){return _hide()};the.update=function(){return _update()};the.search=function(){return _search()};the.complete=function(){return _complete()};the.clear=function(){return _clear()};the.isProcessing=function(){return the.processing};the.getQuery=function(){return the.inputElement.value};the.getMenu=function(){return the.menuObject};the.getFormElement=function(){return the.formElement};the.getInputElement=function(){return the.inputElement};the.getContentElement=function(){return the.contentElement};the.getElement=function(){return the.element};the.destroy=function(){return _destroy()};the.on=function(name,handler){return KTEventHandler.on(the.element,name,handler)};the.one=function(name,handler){return KTEventHandler.one(the.element,name,handler)};the.off=function(name,handlerId){return KTEventHandler.off(the.element,name,handlerId)}};KTSearch.getInstance=function(element){if(element!==null&&KTUtil.data(element).has("search")){return KTUtil.data(element).get("search")}else{return null}};if(typeof module!=="undefined"&&typeof module.exports!=="undefined"){module.exports=KTSearch}